                    <!DOCTYPE html>
                    <html lang="th">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>üß™ Test Product Aggregation</title>
                        <style>
                            * {
                                margin: 0;
                                padding: 0;
                                box-sizing: border-box;
                            }

                            body {
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                min-height: 100vh;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                padding: 20px;
                            }

                            .container {
                                background: white;
                                border-radius: 20px;
                                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                                padding: 40px;
                                max-width: 600px;
                                width: 100%;
                            }

                            h1 {
                                color: #333;
                                margin-bottom: 10px;
                                font-size: 28px;
                            }

                            .subtitle {
                                color: #666;
                                margin-bottom: 30px;
                                font-size: 14px;
                            }

                            .form-group {
                                margin-bottom: 20px;
                            }

                            label {
                                display: block;
                                color: #555;
                                font-weight: 600;
                                margin-bottom: 8px;
                                font-size: 14px;
                            }

                            input, select {
                                width: 100%;
                                padding: 12px 16px;
                                border: 2px solid #e0e0e0;
                                border-radius: 10px;
                                font-size: 16px;
                                transition: border-color 0.3s;
                            }

                            input:focus, select:focus {
                                outline: none;
                                border-color: #667eea;
                            }

                            button {
                                width: 100%;
                                padding: 15px;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                color: white;
                                border: none;
                                border-radius: 10px;
                                font-size: 16px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: transform 0.2s, box-shadow 0.2s;
                                margin-top: 10px;
                            }

                            button:hover {
                                transform: translateY(-2px);
                                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
                            }

                            button:active {
                                transform: translateY(0);
                            }

                            button:disabled {
                                background: #ccc;
                                cursor: not-allowed;
                                transform: none;
                            }

                            .result {
                                margin-top: 30px;
                                padding: 20px;
                                border-radius: 10px;
                                display: none;
                            }

                            .result.success {
                                background: #d4edda;
                                border: 2px solid #28a745;
                                color: #155724;
                            }

                            .result.error {
                                background: #f8d7da;
                                border: 2px solid #dc3545;
                                color: #721c24;
                            }

                            .result.loading {
                                background: #fff3cd;
                                border: 2px solid #ffc107;
                                color: #856404;
                                display: block;
                            }

                            .result h3 {
                                margin-bottom: 10px;
                                font-size: 18px;
                            }

                            .result pre {
                                background: rgba(0,0,0,0.05);
                                padding: 15px;
                                border-radius: 8px;
                                overflow-x: auto;
                                font-size: 13px;
                                line-height: 1.6;
                                max-height: 300px;
                                overflow-y: auto;
                            }

                            .spinner {
                                border: 3px solid #f3f3f3;
                                border-top: 3px solid #667eea;
                                border-radius: 50%;
                                width: 30px;
                                height: 30px;
                                animation: spin 1s linear infinite;
                                margin: 10px auto;
                            }

                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }

                            .info-box {
                                background: #e7f3ff;
                                border-left: 4px solid #2196F3;
                                padding: 15px;
                                margin-bottom: 20px;
                                border-radius: 5px;
                                font-size: 14px;
                                color: #0d47a1;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <h1>üß™ Test Product Aggregation</h1>
                            <p class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>

                            <div class="info-box">
                                ‚ÑπÔ∏è Function ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                            </div>

                            <form id="testForm">
                                <div class="form-group">
                                    <label for="machineId">üè≠ Machine ID:</label>
                                    <select id="machineId" required>
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Machine --</option>
                                        <option value="MC2">MC2</option>
                                        <option value="MC3">MC3</option>
                                        <option value="MC5" selected>MC5</option>
                                        <option value="MC6">MC6</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="monthId">üìÖ Month (YYYY-MM):</label>
                                    <input type="month" id="monthId" required value="2025-11">
                                </div>

                                <div class="form-group">
                                    <label for="productType">üì¶ Product Type:</label>
                                    <select id="productType" required>
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                                        <option value="Modal">Modal</option>
                                        <option value="Grey">Grey</option>
                                        <option value="NonWoven" selected>NonWoven</option>
                                    </select>
                                </div>

                                <button type="submit" id="submitBtn">
                                    üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö Aggregation
                                </button>
                            </form>

                            <div id="result" class="result"></div>
                        </div>

                        <!-- Firebase SDK -->
                        <script type="module">
                            import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
                            import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';

                            // üîß ‡πÉ‡∏™‡πà Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                            const firebaseConfig = {
                                apiKey: "AIzaSyCYalG5sMWG9jy4Lg-475TH_xuIRwA146w",
            authDomain: "lab-trc-management-system.firebaseapp.com",
            projectId: "lab-trc-management-system",
            storageBucket: "lab-trc-management-system.appspot.com",
            messagingSenderId: "43919979160",
            appId: "1:43919979160:web:779cb9de75cd4b9fce56ed"
                            };

                            const app = initializeApp(firebaseConfig);
                            const functions = getFunctions(app, 'asia-southeast1'); // ‡πÉ‡∏ä‡πâ Region ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Backend

                            const form = document.getElementById('testForm');
                            const resultDiv = document.getElementById('result');
                            const submitBtn = document.getElementById('submitBtn');

                            form.addEventListener('submit', async (e) => {
                                e.preventDefault();

                                const machineId = document.getElementById('machineId').value;
                                const monthId = document.getElementById('monthId').value;
                                const productType = document.getElementById('productType').value;

                                if (!machineId || !monthId || !productType) {
                                    showResult('error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                                    return;
                                }

                                // Show loading
                                resultDiv.className = 'result loading';
                                resultDiv.innerHTML = `
                                    <h3>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</h3>
                                    <div class="spinner"></div>
                                    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 10-30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</p>
                                `;
                                resultDiv.style.display = 'block';
                                submitBtn.disabled = true;

                                try {
                                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Cloud Function
                                    const testFunction = httpsCallable(functions, 'manualTestProductAggregation');
                                    const result = await testFunction({
                                        machineId,
                                        monthId,
                                        productType
                                    });

                                    console.log('Result:', result.data);

                                    if (result.data.success) {
                                        showResult('success', result.data.message, result.data);
                                    } else {
                                        showResult('error', result.data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                                    }

                                } catch (error) {
                                    console.error('Error:', error);
                                    showResult('error', `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
                                } finally {
                                    submitBtn.disabled = false;
                                }
                            });

                            function showResult(type, message, data = null) {
                                resultDiv.className = `result ${type}`;
                                resultDiv.style.display = 'block';

                                let html = `<h3>${type === 'success' ? '‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'}</h3>`;
                                html += `<p>${message}</p>`;

                                if (data) {
                                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                                }

                                resultDiv.innerHTML = html;
                            }
                        </script>
                    </body>
                    </html>