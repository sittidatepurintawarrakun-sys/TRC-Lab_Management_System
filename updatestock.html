<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initial Stock Setup (One-time use)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏° Timestamp ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô import
        import { getFirestore, doc, setDoc, Timestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYalG5sMWG9jy4Lg-475TH_xuIRwA146w",
            authDomain: "lab-trc-management-system.firebaseapp.com",
            projectId: "lab-trc-management-system",
            storageBucket: "lab-trc-management-system.appspot.com",
            messagingSenderId: "43919979160",
            appId: "1:43919979160:web:779cb9de75cd4b9fce56ed"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Brand ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ô Dropdown)
        const brands = [
            { id: "ARAUCO FSC Mix Credit", name: "ARAUCO FSC Mix Credit" },
            { id: "ARAUCO FSC Control Wood", name: "ARAUCO FSC Control Wood" },
            { id: "ARAUCO PEFC", name: "ARAUCO PEFC" },
            { id: "AVN FSC Mix Credit", name: "AVN FSC Mix Credit" },
            { id: "AVN FSC Control Wood", name: "AVN FSC Control Wood" },
            { id: "AVN PEFC", name: "AVN PEFC" },
            { id: "AVC FSC Mix Credit", name: "AVC FSC Mix Credit" },
            { id: "AVC FSC Control Wood", name: "AVC FSC Control Wood" },
            { id: "AVC PEFC", name: "AVC PEFC" },
            { id: "PHOENIX Mix Credit", name: "PHOENIX Mix Credit" },
            { id: "PHOENIX Control Wood", name: "PHOENIX Control Wood" },
            { id: "PHOENIX PEFC", name: "PHOENIX PEFC" },
            { id: "SAICCOR FSC Mix Credit 70%", name: "SAICCOR FSC Mix Credit 70%" }
        ];

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Input ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.initForm = () => {
            const container = document.getElementById('stockInputs');
            let html = "";

            brands.forEach(b => {
                html += `
                <div class="grid grid-cols-12 gap-4 items-center mb-2 bg-gray-50 p-2 rounded border">
                    <div class="col-span-5 text-sm font-bold text-gray-700">${b.name}</div>
                    <div class="col-span-3 text-xs text-green-600 font-bold bg-green-100 px-2 py-1 rounded w-fit">NORMAL</div>
                    <div class="col-span-4">
                        <input type="number" id="${b.id}__NORMAL" step="0.001" placeholder="0.000" class="w-full border rounded p-1 text-right font-mono text-blue-800 font-bold">
                    </div>
                </div>`;

                html += `
                <div class="grid grid-cols-12 gap-4 items-center mb-4 p-2 border-b">
                    <div class="col-span-5 text-sm text-gray-500 pl-4">‚Ü≥ (Off Grade)</div>
                    <div class="col-span-3 text-xs text-red-600 font-bold bg-red-100 px-2 py-1 rounded w-fit">OFF GRADE</div>
                    <div class="col-span-4">
                        <input type="number" id="${b.id}__OFF" step="0.001" placeholder="0.000" class="w-full border rounded p-1 text-right font-mono text-red-800">
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        };

        window.saveInitialStock = async () => {
            if(!confirm("‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤?\n‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ó‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ")) return;

            const inputs = document.querySelectorAll('input[type="number"]');
            const btn = document.getElementById('btnSave');
            btn.disabled = true;
            btn.innerText = "‚è≥ Saving...";

            let count = 0;
            try {
                const promises = [];
                inputs.forEach(input => {
                    const val = parseFloat(input.value);
                    if (val > 0) { // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0
                        const docId = input.id; // ID ‡∏Ñ‡∏∑‡∏≠ "BRAND__GRADE"
                        const docRef = doc(db, "store_inventory_balance", docId);

                        // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏° lastUpdated: Timestamp.now() ‡∏•‡∏á‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
                        promises.push(setDoc(docRef, { 
                            balance: val,
                            lastUpdated: Timestamp.now()
                        }, { merge: true }));
                        count++;
                    }
                });

                await Promise.all(promises);
                alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£!`);

                // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥
                inputs.forEach(input => input.value = '');

            } catch (error) {
                console.error(error);
                alert("‚ùå Error: " + error.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Save Initial Stock)";
            }
        };

        window.onload = initForm;
    </script>
</head>
<body class="bg-gray-100 p-8 font-sans">
    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-indigo-600 p-4 text-white flex justify-between items-center">
            <h1 class="text-xl font-bold">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Initial Stock Setup)</h1>
            <span class="text-xs bg-indigo-500 px-2 py-1 rounded">Admin Tool</span>
        </div>

        <div class="p-6">
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 text-sm text-yellow-800">
                <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á) <br>
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô <strong>"‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"</strong> ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á Transaction Log
            </div>

            <div id="stockInputs" class="mb-6 max-h-[60vh] overflow-y-auto pr-2">
                </div>

            <button id="btnSave" onclick="saveInitialStock()" class="w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-bold shadow-lg text-lg transition">
                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Save Initial Stock)
            </button>
        </div>
    </div>
</body>
</html>